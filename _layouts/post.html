---
layout: default
---

<article class="post">
  <div class="post-shell">
    <div class="post-main">
      <p class="post-meta-line">
        <span>{{ page.date | date: "%b %-d, %Y" }}</span>
        {% if page.categories and page.categories.size > 0 %}
          <span class="dot" aria-hidden="true">&bull;</span>
          <span class="caps">{{ page.categories | join: " | " }}</span>
        {% endif %}
      </p>

      <h1 class="post-title">{{ page.title }}</h1>

      {% if page.tags %}
        <div class="tag-row">
          {% for tag in page.tags %}
            <span class="tag-chip">{{ tag }}</span>
          {% endfor %}
        </div>
      {% endif %}

      <div class="post-body">
        {{ content }}
      </div>
    </div>

    <aside id="post-toc" class="toc-card" aria-label="Table of contents"></aside>
  </div>
</article>

<script>
(function () {
  const tocRoot = document.getElementById('post-toc');
  const headings = Array.from(
    document.querySelectorAll('.post-body h2, .post-body h3')
  );

  if (!tocRoot || headings.length === 0) {
    tocRoot?.remove();
    return;
  }

  const rootList = document.createElement('ul');
  rootList.className = 'toc-list';

  let currentH2Li = null;
  let currentSubList = null;
  const headingMap = new Map();

  headings.forEach((h, i) => {
    if (!h.id) h.id = `section-${i + 1}`;

    if (h.tagName === 'H2') {
      const li = document.createElement('li');
      li.className = 'toc-item';

      const a = document.createElement('a');
      a.href = `#${h.id}`;
      a.textContent = h.textContent;

      li.appendChild(a);
      rootList.appendChild(li);

      currentH2Li = li;
      currentSubList = null;
      headingMap.set(h.id, li);
    }

    if (h.tagName === 'H3' && currentH2Li) {
      if (!currentSubList) {
        currentSubList = document.createElement('ul');
        currentSubList.className = 'toc-list depth-2';
        currentH2Li.appendChild(currentSubList);
      }

      const li = document.createElement('li');
      li.className = 'toc-item depth-2';

      const a = document.createElement('a');
      a.href = `#${h.id}`;
      a.textContent = h.textContent;

      li.appendChild(a);
      currentSubList.appendChild(li);
      headingMap.set(h.id, li);
    }
  });

  const title = document.createElement('div');
  title.className = 'toc-title';
  title.textContent = 'Contents';

  tocRoot.appendChild(title);
  tocRoot.appendChild(rootList);

  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach(entry => {
        if (!entry.isIntersecting) return;
        document.querySelectorAll('.toc-item.active')
          .forEach(el => el.classList.remove('active'));
        headingMap.get(entry.target.id)?.classList.add('active');
      });
    },
    { rootMargin: '-30% 0px -60% 0px' }
  );

  headings.forEach(h => observer.observe(h));
})();
</script>
