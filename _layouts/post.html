---
layout: default
---

<article class="post">
  <div class="post-shell">
    <div class="post-main">
      <p class="post-meta-line">
        <span>{{ page.date | date: "%b %-d, %Y" }}</span>
        {% if page.categories and page.categories.size > 0 %}
          <span class="dot" aria-hidden="true">&bull;</span>
          <span class="caps">{{ page.categories | join: " | " }}</span>
        {% endif %}
      </p>

      <h1 class="post-title">{{ page.title }}</h1>

      {% if page.tags %}
        <div class="tag-row">
          {% for tag in page.tags %}
            <span class="tag-chip">{{ tag }}</span>
          {% endfor %}
        </div>
      {% endif %}

      <div class="post-body">
        {{ content }}
      </div>
    </div>

    <aside id="post-toc" class="toc-card" aria-label="Table of contents"></aside>
  </div>
</article>

<script>
  (function () {
    const tocRoot = document.getElementById('post-toc');
    const headings = Array.from(document.querySelectorAll('.post-body h2'));
    if (!tocRoot || headings.length === 0) {
      if (tocRoot) tocRoot.style.display = 'none';
      return;
    }

    const list = document.createElement('ul');
    list.className = 'toc-list';
    const headingMap = new Map();

    headings.forEach((h, idx) => {
      if (!h.id) h.id = 'section-' + (idx + 1);

      const li = document.createElement('li');
      li.className = 'toc-item';

      const link = document.createElement('a');
      link.href = '#' + h.id;
      link.textContent = h.textContent;

      li.appendChild(link);
      list.appendChild(li);
      headingMap.set(h.id, li);
    });


    const title = document.createElement('div');
    title.className = 'toc-title';
    title.textContent = 'Contents';

    tocRoot.appendChild(title);
    tocRoot.appendChild(list);

    const setActive = (id) => {
      document.querySelectorAll('.toc-item.active').forEach((el) => el.classList.remove('active'));
      const li = headingMap.get(id);
      if (li) li.classList.add('active');
    };

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) setActive(entry.target.id);
        });
      },
      { rootMargin: '-25% 0px -60% 0px', threshold: [0, 1] }
    );

    headings.forEach((h) => observer.observe(h));
    const firstId = headings[0]?.id;
    if (firstId) setActive(firstId);

    list.querySelectorAll('a').forEach((a) => {
      a.addEventListener('click', () => setActive(a.getAttribute('href').replace('#', '')));
    });
  })();
</script>
