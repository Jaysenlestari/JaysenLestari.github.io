---
layout: default
---

<article class="post">
  <div class="post-shell">
    <div class="post-main">
      <p class="post-meta-line">
        <span>{{ page.date | date: "%b %-d, %Y" }}</span>
        {% if page.categories and page.categories.size > 0 %}
          <span class="dot" aria-hidden="true">&bull;</span>
          <span class="caps">{{ page.categories | join: " | " }}</span>
        {% endif %}
      </p>

      <h1 class="post-title">{{ page.title }}</h1>

      {% if page.tags %}
        <div class="tag-row">
          {% for tag in page.tags %}
            <span class="tag-chip">{{ tag }}</span>
          {% endfor %}
        </div>
      {% endif %}

      <div class="post-body">
        {{ content }}
      </div>
    </div>

    <aside id="post-toc" class="toc-card" aria-label="Table of contents"></aside>
  </div>
  <button id="toc-toggle" class="toc-toggle" type="button" aria-expanded="false" aria-controls="post-toc" aria-label="Toggle table of contents">
    <svg viewBox="0 0 24 24" role="presentation">
      <path d="M4 5.5c0-.55.45-1 1-1h14a1 1 0 1 1 0 2H5a1 1 0 0 1-1-1Zm0 6c0-.55.45-1 1-1h8a1 1 0 1 1 0 2H5a1 1 0 0 1-1-1Zm0 6c0-.55.45-1 1-1h14a1 1 0 1 1 0 2H5a1 1 0 0 1-1-1Z"/>
    </svg>
  </button>
</article>
<script>
(function () {
  const tocRoot = document.getElementById('post-toc');
  const postBody = document.querySelector('.post-body');
  if (!tocRoot || !postBody) return;

  const headings = Array.from(postBody.querySelectorAll('h2, h3'));
  if (headings.length === 0) { tocRoot.remove(); document.getElementById('toc-toggle')?.remove(); return; }

  const rootList = document.createElement('ul');
  rootList.className = 'toc-list';
  const headingMap = new Map();
  let currentH2Li = null;

  headings.forEach((h, i) => {
    if (!h.id) h.id = `section-${i + 1}`;
    const li = document.createElement('li');
    const a = document.createElement('a');
    a.href = `#${h.id}`; a.textContent = h.textContent;

    if (h.tagName === 'H2') {
      li.className = 'toc-item';
      li.appendChild(a);
      rootList.appendChild(li);
      currentH2Li = li;
    } else if (h.tagName === 'H3' && currentH2Li) {
      let sub = currentH2Li.querySelector('ul') || document.createElement('ul');
      sub.className = 'toc-list depth-2';
      const subLi = document.createElement('li');
      subLi.className = 'toc-item depth-2';
      subLi.appendChild(a);
      sub.appendChild(subLi);
      if (!currentH2Li.contains(sub)) currentH2Li.appendChild(sub);
    }
    headingMap.set(h.id, li);
  });

  tocRoot.innerHTML = '<div class="toc-title">Contents</div>';
  tocRoot.appendChild(rootList);

  const tocToggle = document.getElementById('toc-toggle');
  if (tocToggle) {
    tocToggle.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopImmediatePropagation();
      const isOpened = tocRoot.classList.toggle('open');
      document.body.classList.toggle('toc-open', isOpened);
    });
  }

  // Scroll Spy
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        document.querySelectorAll('.toc-item.active').forEach(el => el.classList.remove('active'));
        headingMap.get(entry.target.id)?.classList.add('active');
      }
    });
  }, { rootMargin: '-10% 0px -70% 0px' });
  headings.forEach(h => observer.observe(h));

  document.addEventListener('click', (e) => {
    if (tocRoot.classList.contains('open') && !tocRoot.contains(e.target) && !tocToggle?.contains(e.target)) {
      tocRoot.classList.remove('open');
      document.body.classList.remove('toc-open');
    }
  });
})();
</script>
